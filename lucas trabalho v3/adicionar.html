<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Lista de Compras Premium</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap');
  body {margin:0;font-family:'Roboto',sans-serif;background:#f4f6f8;display:flex;min-height:100vh;}
  .sidebar {width:220px;background:#4CAF50;color:white;display:flex;flex-direction:column;padding-top:20px;flex-shrink:0;}
  .sidebar h2 {text-align:center;margin-bottom:30px;}
  .sidebar a {padding:15px 20px;text-decoration:none;color:white;font-weight:500;transition:0.3s;cursor:pointer;}
  .sidebar a:hover, .sidebar a.active {background:rgba(255,255,255,0.2);}
  .main {flex:1;padding:40px;}
  h1,h2 {color:#333;}
  form {display:flex;flex-wrap:wrap;gap:10px;margin-bottom:20px;}
  form input, form button, form select {padding:10px;font-size:16px;border-radius:5px;border:1px solid #ccc;}
  form input, form select {flex:1 1 200px;}
  form button {background:#4CAF50;color:white;border:none;cursor:pointer;transition:0.3s;}
  form button:hover {background:#45a049;}
  table {width:100%;border-collapse:collapse;background:white;border-radius:8px;overflow:hidden;box-shadow:0 2px 10px rgba(0,0,0,0.1);}
  th,td {padding:12px;text-align:center;border-bottom:1px solid #ddd;}
  th {background:#4CAF50;color:white;}
  td button {background:#f44336;color:white;border:none;padding:6px 10px;border-radius:5px;cursor:pointer;margin-left:5px;}
  td button.edit {background:#ff9800;}
  td button:hover {opacity:0.8;}
  .stats {background:white;padding:20px;border-radius:8px;max-width:800px;box-shadow:0 2px 10px rgba(0,0,0,0.1);}
  .stats p {font-size:18px;margin:10px 0;}
  .filters {margin-bottom:20px; display:flex; gap:10px; flex-wrap:wrap;}
  canvas {background:white;border-radius:8px;padding:20px;box-shadow:0 2px 10px rgba(0,0,0,0.1);margin-top:20px;}
</style>
</head>
<body>

<div class="sidebar">
  <h2>Minha Lista</h2>
  <a class="active" onclick="showSection('add')">Adicionar Item</a>
  <a onclick="showSection('list')">Ver Lista</a>
  <a onclick="showSection('stats')">Estatísticas</a>
</div>

<div class="main">
  <!-- Adicionar Item -->
  <div id="add">
    <h1>Adicionar Item</h1>
    <form id="shoppingForm">
      <input type="text" id="itemName" placeholder="Nome do item" required>
      <input type="number" id="itemQty" placeholder="Quantidade" min="1" required>
      <input type="number" id="itemKg" placeholder="Peso (kg)" min="0.01" step="0.01" required>
      <input type="date" id="itemDate" required>
      <button type="submit">Adicionar</button>
    </form>
  </div>

  <!-- Ver Lista -->
  <div id="list" style="display:none;">
    <h1>Itens Comprados</h1>
    <div class="filters">
      <input type="text" id="filterName" placeholder="Filtrar por nome">
      <input type="date" id="filterDate">
      <button onclick="applyFilters()">Aplicar Filtro</button>
      <button onclick="resetFilters()">Resetar Filtro</button>
      <button onclick="exportCSV()">Exportar CSV</button>
    </div>
    <table>
      <thead>
        <tr>
          <th>Item</th>
          <th>Quantidade</th>
          <th>Peso (kg)</th>
          <th>Data</th>
          <th>Ações</th>
        </tr>
      </thead>
      <tbody id="shoppingTable"></tbody>
    </table>
  </div>

  <!-- Estatísticas -->
  <div id="stats" style="display:none;">
    <h1>Estatísticas</h1>
    <div class="stats">
      <p id="totalItems">Total de itens: 0</p>
      <p id="totalQty">Total de quantidade: 0</p>
      <p id="totalKg">Total de peso: 0 kg</p>
      <canvas id="chartQty" width="400" height="200"></canvas>
      <canvas id="chartKg" width="400" height="200"></canvas>
    </div>
  </div>
</div>

<script>
let shoppingList = JSON.parse(localStorage.getItem('shoppingList')) || [];
let filteredList = [...shoppingList];
let chartQty, chartKg;

const sections = { add: document.getElementById('add'), list: document.getElementById('list'), stats: document.getElementById('stats')};
const sidebarLinks = document.querySelectorAll('.sidebar a');

function showSection(section){
  for(const sec in sections) sections[sec].style.display='none';
  sections[section].style.display='block';
  sidebarLinks.forEach(link=>link.classList.remove('active'));
  sidebarLinks[[...sidebarLinks].findIndex(a=>a.textContent.includes(section.charAt(0).toUpperCase()+section.slice(1)))]?.classList.add('active');
  updateTable();
  updateStats();
}

// Adicionar item
document.getElementById('shoppingForm').addEventListener('submit',function(e){
  e.preventDefault();
  const name = document.getElementById('itemName').value;
  const qty = Number(document.getElementById('itemQty').value);
  const kg = Number(document.getElementById('itemKg').value);
  const date = document.getElementById('itemDate').value;

  shoppingList.push({name, qty, kg, date});
  localStorage.setItem('shoppingList',JSON.stringify(shoppingList));
  this.reset();
  showSection('list');
});

// Atualizar tabela
function updateTable(){
  const table=document.getElementById('shoppingTable');
  table.innerHTML='';
  filteredList.forEach((item,index)=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`
      <td>${item.name}</td>
      <td>${item.qty}</td>
      <td>${item.kg}</td>
      <td>${item.date}</td>
      <td>
        <button class="edit" onclick="editItem(${index})">Editar</button>
        <button onclick="removeItem(${index})">Remover</button>
      </td>`;
    table.appendChild(tr);
  });
}

// Remover item
function removeItem(index){
  shoppingList.splice(index,1);
  saveAndRefresh();
}

// Editar item
function editItem(index){
  const item=filteredList[index];
  document.getElementById('itemName').value=item.name;
  document.getElementById('itemQty').value=item.qty;
  document.getElementById('itemKg').value=item.kg;
  document.getElementById('itemDate').value=item.date;
  showSection('add');
  shoppingList.splice(shoppingList.indexOf(item),1);
  saveAndRefresh(false);
}

// Salvar e atualizar tabela e estatísticas
function saveAndRefresh(updateStatsFlag=true){
  localStorage.setItem('shoppingList',JSON.stringify(shoppingList));
  filteredList=[...shoppingList];
  updateTable();
  if(updateStatsFlag) updateStats();
}

// Atualizar estatísticas e gráficos
function updateStats(){
  const totalItems=shoppingList.length;
  const totalQty=shoppingList.reduce((sum,item)=>sum+item.qty,0);
  const totalKg=shoppingList.reduce((sum,item)=>sum+item.kg,0);
  document.getElementById('totalItems').textContent=`Total de itens: ${totalItems}`;
  document.getElementById('totalQty').textContent=`Total de quantidade: ${totalQty}`;
  document.getElementById('totalKg').textContent=`Total de peso: ${totalKg.toFixed(2)} kg`;

  const names = shoppingList.map(i=>i.name);
  const qtys = shoppingList.map(i=>i.qty);
  const kgs = shoppingList.map(i=>i.kg);

  if(chartQty) chartQty.destroy();
  if(chartKg) chartKg.destroy();

  const ctxQty = document.getElementById('chartQty').getContext('2d');
  chartQty = new Chart(ctxQty, {type:'bar', data:{labels:names,datasets:[{label:'Quantidade',data:qtys,backgroundColor:'#4CAF50'}]}, options:{responsive:true,plugins:{legend:{display:false}}}});

  const ctxKg = document.getElementById('chartKg').getContext('2d');
  chartKg = new Chart(ctxKg, {type:'line', data:{labels:names,datasets:[{label:'Peso (kg)',data:kgs,borderColor:'#FF9800',backgroundColor:'rgba(255,152,0,0.2)',fill:true,tension:0.3} ]}, options:{responsive:true,plugins:{legend:{display:true}}}});
}

// Filtros
function applyFilters(){
  const nameFilter=document.getElementById('filterName').value.toLowerCase();
  const dateFilter=document.getElementById('filterDate').value;
  filteredList=shoppingList.filter(item=>{
    return (!nameFilter || item.name.toLowerCase().includes(nameFilter)) &&
           (!dateFilter || item.date===dateFilter);
  });
  updateTable();
}
function resetFilters(){
  document.getElementById('filterName').value='';
  document.getElementById('filterDate').value='';
  filteredList=[...shoppingList];
  updateTable();
}

// Exportar CSV
function exportCSV(){
  let csv='Item,Quantidade,Peso(kg),Data\n';
  shoppingList.forEach(item=>{
    csv+=`${item.name},${item.qty},${item.kg},${item.date}\n`;
  });
  const blob=new Blob([csv],{type:'text/csv'});
  const link=document.createElement('a');
  link.href=URL.createObjectURL(blob);
  link.download='lista_compras.csv';
  link.click();
}

// Inicialização
updateTable();
updateStats();
</script>

</body>
</html>

